# Story 6.3: Mission Planner RF Integration and Operator Control

## **ðŸŽ¯ STORY OVERVIEW**

**As a** SAR drone operator using Mission Planner,  
**I want** complete RF control and visualization integrated within Mission Planner interface,  
**so that** I can control frequency selection, monitor RF detection, and manage homing operations without switching between multiple applications.

## **âœ… ACCEPTANCE CRITERIA**

1. **Integrated Frequency Control**: Operator can select RF frequencies directly from Mission Planner parameter interface
2. **Real-time RF Visualization**: RSSI graphs, signal strength indicators, and bearing information displayed in Mission Planner
3. **Unified Homing Control**: Homing activation/deactivation controlled from Mission Planner interface
4. **Enhanced Telemetry**: Signal classification, confidence metrics, and detection events visible in Mission Planner
5. **Operator Workflow Integration**: All RF operations accessible through Mission Planner without external tools
6. **Safety Preservation**: All existing safety overrides and emergency procedures maintained through Mission Planner
7. **Performance Compliance**: RF parameter changes applied with <50ms response time per PRD requirements

## **ðŸ“‹ ACTIVE TODO TASKS**

**`[ ]`** **`[TASK-6.3.1-MISSION-PLANNER-PARAMETER-INTERFACE]`** **Mission Planner Parameter Interface for RF Control** **[Priority: P0]** **[Concurrency: ðŸŸ¡ CONDITIONAL]**
- **Hardware:** *Cube Red via MAVLink, existing proven communication*
- **Files:** `src/backend/services/mavlink_service.py`, MAVLink parameter implementation, RF control interface
- **Dependencies:** Story 6.1 SUBTASK-6.1.3.1 complete (Mission Planner frequency control interface)
- **Integration Points:** **VERIFIED** - Existing `MAVLinkService`, parameter interface, Mission Planner compatibility
- **Parallel Development:** **ðŸŸ¡ CONDITIONAL** - Can develop parameter structure in parallel, sequential dependency at MAVLink implementation
- **Prerequisites:** Enhanced single-frequency processing from Story 6.1
- **Integration Boundary:** MAVLink parameter implementation - requires ASV frequency control from Story 6.1  
- **Resource Conflicts:** Modifications to `mavlink_service.py` - coordinate with telemetry enhancement work
- **Max Developers:** 1 (MAVLink interface implementation)
- **Subtasks:**
  - **[ ]** **SUBTASK-6.3.1.1:** Implement MAVLink parameter interface for frequency control
    - **[ ]** **[28a]** Create MAVLink parameter definitions for RF frequency selection (PISAD_RF_FREQ, PISAD_RF_PROFILE)
    - **[ ]** **[28b]** Implement parameter change handler with <50ms response time for frequency updates
    - **[ ]** **[28c]** Add frequency profile selection parameters (Emergency=406MHz, Aviation=121.5MHz, Custom=user-defined)
    - **[ ]** **[28d]** Create parameter validation to ensure frequency within HackRF operational range (1MHz-6GHz)
  - **[ ]** **SUBTASK-6.3.1.2:** Mission Planner homing control integration
    - **[ ]** **[29a]** Implement homing enable/disable via MAVLink command interface (MAV_CMD_USER_1)
    - **[ ]** **[29b]** Add homing status parameter for Mission Planner display (PISAD_HOMING_STATE)
    - **[ ]** **[29c]** Create emergency RF disable command accessible from Mission Planner (MAV_CMD_USER_2)
    - **[ ]** **[29d]** Implement parameter persistence across system restarts for operator convenience
- **DoD Task:** Mission Planner successfully controls RF frequency and homing operations via parameter interface, <50ms response time achieved
- **DoD Story:** Complete RF control accessible within Mission Planner interface
- **DoD Epic:** Mission Planner RF integration validated in comprehensive testing
- **Context:** Enables unified operator control eliminating need for separate RF control applications
- **PRD Reference:** **PRD-FR11** Operator full override capability, **PRD-FR14** Operator explicitly activate homing mode
- **Progress:** 0%
- **User Approval:** *[PENDING - requires approval before execution]*

**`[ ]`** **`[TASK-6.3.2-ENHANCED-RF-TELEMETRY-VISUALIZATION]`** **Enhanced RF Telemetry and Mission Planner Visualization** **[Priority: P0]** **[Concurrency: ðŸŸ¡ CONDITIONAL]**
- **Hardware:** *HackRF One signal processing, existing telemetry infrastructure*
- **Files:** MAVLink telemetry enhancement, `NAMED_VALUE_FLOAT` message extensions, visualization data
- **Dependencies:** Story 6.1 SUBTASK-6.1.3.2 complete (Enhanced RF telemetry for Mission Planner), Story 6.2 enhanced algorithms
- **Integration Points:** **VERIFIED** - Existing telemetry streaming, Mission Planner display compatibility, ASV enhanced data
- **Parallel Development:** **ðŸŸ¡ CONDITIONAL** - Can develop telemetry structure in parallel, sequential dependency on enhanced algorithm data
- **Prerequisites:** Enhanced signal processing with confidence metrics from Stories 6.1 and 6.2
- **Integration Boundary:** Enhanced telemetry data - requires ASV signal classification and confidence metrics
- **Resource Conflicts:** MAVLink telemetry bandwidth - coordinate to avoid saturation
- **Max Developers:** 1 (telemetry implementation and visualization)
- **Subtasks:**
  - **[ ]** **SUBTASK-6.3.2.1:** Enhanced telemetry message implementation
    - **[ ]** **[30a]** Extend existing `NAMED_VALUE_FLOAT` messages with ASV signal classification (PISAD_SIG_CLASS)
    - **[ ]** **[30b]** Add signal confidence telemetry for Mission Planner display (PISAD_SIG_CONF)
    - **[ ]** **[30c]** Implement bearing and bearing confidence telemetry (PISAD_BEARING, PISAD_BEAR_CONF)
    - **[ ]** **[30d]** Create interference detection indicator telemetry (PISAD_INTERFERENCE)
  - **[ ]** **SUBTASK-6.3.2.2:** Mission Planner visualization optimization  
    - **[ ]** **[31a]** Optimize telemetry rate (2Hz for status, 10Hz for RSSI) to prevent Mission Planner overload
    - **[ ]** **[31b]** Create RSSI trend visualization data compatible with Mission Planner graphing
    - **[ ]** **[31c]** Add RF detection event notifications via `STATUSTEXT` messages
    - **[ ]** **[31d]** Implement signal quality indicators visible in Mission Planner HUD
- **DoD Task:** Enhanced RF telemetry successfully displayed in Mission Planner with optimized update rates
- **DoD Story:** Complete RF situational awareness available within Mission Planner
- **DoD Epic:** Mission Planner RF visualization validated for operational use
- **Context:** Provides operator with comprehensive RF situational awareness without external monitoring tools
- **PRD Reference:** **PRD-FR9** Stream RSSI telemetry to ground control station, **PRD-FR12** Log all signal detections
- **Progress:** 0%
- **User Approval:** *[PENDING - requires approval before execution]*

**`[ ]`** **`[TASK-6.3.3-OPERATOR-WORKFLOW-INTEGRATION]`** **Complete Operator Workflow Integration with Mission Planner** **[Priority: P1]** **[Concurrency: ðŸŸ¡ CONDITIONAL]**
- **Hardware:** *Complete system integration - HackRF, Cube Red, Mission Planner workstation*
- **Files:** Operator documentation, workflow procedures, Mission Planner configuration
- **Dependencies:** TASK-6.3.1 and TASK-6.3.2 complete, RF control and telemetry operational in Mission Planner
- **Integration Points:** **VERIFIED** - Mission Planner interface, operator procedures, system integration
- **Parallel Development:** **ðŸŸ¡ CONDITIONAL** - Can develop documentation in parallel, sequential dependency on interface completion
- **Prerequisites:** RF control and telemetry integration complete from TASK-6.3.1 and TASK-6.3.2
- **Integration Boundary:** Workflow validation - requires completed Mission Planner integration
- **Resource Conflicts:** *None identified* - documentation and procedure focus
- **Max Developers:** 1 (documentation and workflow design)
- **Subtasks:**
  - **[ ]** **SUBTASK-6.3.3.1:** Mission Planner configuration and setup procedures
    - **[ ]** **[32a]** Create Mission Planner parameter configuration guide for PISAD RF integration
    - **[ ]** **[32b]** Document frequency selection procedures and operational frequency ranges  
    - **[ ]** **[32c]** Create homing activation workflow within Mission Planner interface
    - **[ ]** **[32d]** Design emergency procedures and safety override documentation for Mission Planner users
  - **[ ]** **SUBTASK-6.3.3.2:** Operator training and workflow validation
    - **[ ]** **[33a]** Create operator training procedures for integrated RF control within Mission Planner
    - **[ ]** **[33b]** Design mission planning procedures incorporating RF detection and homing operations
    - **[ ]** **[33c]** Document troubleshooting procedures for RF integration issues within Mission Planner
    - **[ ]** **[33d]** Create operator reference cards for quick RF control access during operations
- **DoD Task:** Complete operator workflow documented and validated for Mission Planner RF integration
- **DoD Story:** Mission Planner RF integration ready for operator training and field deployment
- **DoD Epic:** Complete Mission Planner RF integration validated for operational deployment  
- **Context:** Ensures seamless operator transition to integrated RF control within familiar Mission Planner interface
- **PRD Reference:** **PRD-NFR10** System deployment by single operator achievable in under 15 minutes
- **Progress:** 0%
- **User Approval:** *[PENDING - requires approval before execution]*

**`[ ]`** **`[TASK-6.3.4-INTEGRATION-TESTING-AND-VALIDATION]`** **Mission Planner RF Integration Testing** **[Priority: P1]** **[Concurrency: ðŸ”´ SEQUENTIAL]**
- **Hardware:** *Complete hardware setup - HackRF One, Cube Red, Mission Planner workstation*
- **Files:** Integration test suite, validation scripts, performance benchmarking
- **Dependencies:** TASK-6.3.1, TASK-6.3.2, and TASK-6.3.3 complete, full Mission Planner RF integration operational
- **Integration Points:** **VERIFIED** - Complete system integration, Mission Planner compatibility, operator workflow validation
- **Parallel Development:** **ðŸ”´ SEQUENTIAL** - Requires complete Mission Planner integration before testing
- **Prerequisites:** Full Mission Planner RF integration operational
- **Integration Boundary:** N/A (standalone testing task)
- **Resource Conflicts:** Hardware usage for testing - coordinate with development activities
- **Max Developers:** 1 (testing and validation focus)
- **Subtasks:**
  - **[ ]** **SUBTASK-6.3.4.1:** Mission Planner integration testing
    - **[ ]** **[34a]** Test frequency selection via Mission Planner parameters with <50ms response time validation
    - **[ ]** **[34b]** Validate homing control activation/deactivation through Mission Planner interface
    - **[ ]** **[34c]** Test enhanced telemetry display and update rates in Mission Planner
    - **[ ]** **[34d]** Validate emergency override procedures through Mission Planner safety controls
  - **[ ]** **SUBTASK-6.3.4.2:** Performance and compatibility validation
    - **[ ]** **[35a]** Benchmark Mission Planner responsiveness with RF telemetry load (2Hz status, 10Hz RSSI)
    - **[ ]** **[35b]** Validate Mission Planner compatibility across versions (1.3.75+)
    - **[ ]** **[35c]** Test integration stability during extended operations (>1 hour continuous)
    - **[ ]** **[35d]** Validate operator workflow efficiency compared to separate RF control applications
- **DoD Task:** Mission Planner RF integration passes comprehensive testing and meets performance requirements
- **DoD Story:** Mission Planner RF integration validated and ready for Story 6.4 field testing
- **DoD Epic:** Complete Mission Planner integration ready for operational deployment and field validation
- **Context:** Ensures Mission Planner RF integration meets all performance and reliability requirements before field deployment
- **PRD Reference:** **PRD-NFR1** MAVLink communication <1% packet loss, **PRD-NFR2** Signal processing latency <100ms
- **Progress:** 0%
- **User Approval:** *[PENDING - requires approval before execution]*

## **ðŸ”§ TECHNICAL ARCHITECTURE**

### Mission Planner Parameter Integration
```python
# MAVLink Parameter Interface for Mission Planner RF Control
class MissionPlannerRFInterface:
    """Mission Planner RF control integration via MAVLink parameters."""
    
    PARAMETERS = {
        # Frequency Control Parameters
        'PISAD_RF_FREQ': {
            'type': 'REAL32',
            'range': (1_000_000, 6_000_000_000),  # 1MHz - 6GHz
            'default': 406_000_000,  # 406MHz emergency beacon
            'description': 'RF Center Frequency (Hz)'
        },
        'PISAD_RF_PROFILE': {
            'type': 'INT32',
            'range': (0, 2),  # 0=Emergency, 1=Aviation, 2=Custom
            'default': 0,
            'description': 'RF Profile Selection'
        },
        # Homing Control Parameters  
        'PISAD_HOMING_ENABLE': {
            'type': 'INT32',
            'range': (0, 1),
            'default': 0,
            'description': 'RF Homing Enable (0=Off, 1=On)'
        },
        'PISAD_HOMING_STATE': {
            'type': 'INT32',
            'readonly': True,
            'description': 'Current Homing State'
        }
    }
    
    async def handle_parameter_change(self, param_name: str, new_value: Any) -> bool:
        """Handle Mission Planner parameter changes with <50ms response time."""
        start_time = time.perf_counter()
        
        if param_name == 'PISAD_RF_FREQ':
            await self.asv_service.set_frequency(new_value)
        elif param_name == 'PISAD_RF_PROFILE':
            await self.apply_frequency_profile(new_value)
        elif param_name == 'PISAD_HOMING_ENABLE':
            await self.toggle_homing(bool(new_value))
            
        response_time = (time.perf_counter() - start_time) * 1000
        logger.info(f"Parameter {param_name} updated in {response_time:.1f}ms")
        return response_time < 50.0  # <50ms requirement
```

### Enhanced Telemetry for Mission Planner
```python
# Enhanced RF Telemetry Stream for Mission Planner Visualization
class MissionPlannerTelemetryService:
    """Enhanced RF telemetry optimized for Mission Planner display."""
    
    TELEMETRY_MESSAGES = {
        # High-frequency telemetry (10Hz)
        'PISAD_RSSI': ('RSSI dBm', 'signal_processor.current_rssi'),
        'PISAD_SNR': ('SNR dB', 'signal_processor.current_snr'),
        
        # Medium-frequency telemetry (2Hz)
        'PISAD_SIG_CONF': ('Signal Confidence %', 'asv_analyzer.confidence'),
        'PISAD_BEARING': ('Bearing Degrees', 'asv_analyzer.bearing'),
        'PISAD_BEAR_CONF': ('Bearing Confidence %', 'asv_analyzer.bearing_confidence'),
        'PISAD_SIG_CLASS': ('Signal Class', 'asv_analyzer.signal_classification'),
        
        # Low-frequency telemetry (0.5Hz)
        'PISAD_INTERFERENCE': ('Interference Level', 'asv_analyzer.interference_level'),
        'PISAD_RF_HEALTH': ('RF System Health', 'asv_service.health_status')
    }
    
    async def stream_telemetry_optimized(self):
        """Stream RF telemetry with optimized rates for Mission Planner."""
        # High-frequency RSSI data (10Hz)
        if self.should_send_high_freq():
            await self.send_named_value_float('PISAD_RSSI', self.get_current_rssi())
            
        # Medium-frequency enhanced data (2Hz) 
        if self.should_send_medium_freq():
            await self.send_enhanced_rf_telemetry()
            
        # Detection events via STATUSTEXT immediately
        if self.new_detection_event:
            await self.send_statustext(f"RF Detection: {self.latest_detection}")
```

### Operator Workflow Integration
```python
# Mission Planner RF Workflow Integration
class MissionPlannerWorkflow:
    """Integrated RF workflow within Mission Planner interface."""
    
    RF_PROFILES = {
        0: {'name': 'Emergency Beacon', 'freq': 406_000_000, 'bandwidth': 25_000},
        1: {'name': 'Aviation Emergency', 'freq': 121_500_000, 'bandwidth': 50_000},
        2: {'name': 'Custom', 'freq': 'user_defined', 'bandwidth': 'user_defined'}
    }
    
    HOMING_WORKFLOW = {
        'pre_activation_checks': [
            'verify_guided_mode',
            'confirm_signal_detected',
            'validate_safety_systems',
            'operator_confirmation'
        ],
        'activation_sequence': [
            'set_homing_parameter',
            'monitor_confirmation',
            'verify_velocity_commands',
            'continuous_monitoring'
        ],
        'emergency_procedures': [
            'mode_change_override',
            'emergency_disable_command',
            'manual_control_resume'
        ]
    }
```

## **ðŸ“Š MISSION PLANNER INTEGRATION BENEFITS**

| Feature | Current Separate Tools | Integrated Mission Planner | Improvement |
|---------|----------------------|---------------------------|-------------|
| **Frequency Selection** | External RF app | Mission Planner parameters | **Unified interface** |
| **Homing Control** | Separate web UI | Mission Planner commands | **Single application** |
| **RF Visualization** | External monitoring | Mission Planner telemetry | **Integrated display** |
| **Emergency Override** | Multiple interfaces | Mission Planner safety | **Streamlined response** |
| **Operator Training** | Multi-app complexity | Single familiar interface | **Simplified workflows** |
| **Mission Planning** | Manual coordination | Integrated RF operations | **Seamless planning** |

## **ðŸ”„ DEPENDENCIES AND INTEGRATION**

### Story Dependencies
- **Story 6.1**: ASV foundation and Mission Planner interface foundation complete
- **Story 6.2**: Enhanced homing algorithms provide confidence metrics for telemetry
- **Story 6.4**: Field testing validates complete Mission Planner integration

### Hardware Dependencies
- **Cube Red**: Existing MAVLink communication (no hardware changes)
- **Mission Planner Workstation**: Standard GCS computer with Mission Planner 1.3.75+
- **Network Connection**: Standard MAVLink communication (USB/telemetry radio)

### Service Integration Points
- **Preserved**: All existing MAVLink communication and safety overrides
- **Enhanced**: RF control and telemetry through Mission Planner interface
- **Extended**: Operator workflow integration eliminating external applications
- **Maintained**: 100% compatibility with existing Mission Planner functionality

## **ðŸŽ¯ SUCCESS CRITERIA**

### Technical Validation
- **Parameter Interface**: RF frequency selection via Mission Planner parameters <50ms response
- **Telemetry Integration**: Enhanced RF data displayed in Mission Planner without overload
- **Homing Control**: Complete homing operation control through Mission Planner interface
- **Safety Preservation**: All emergency overrides accessible through Mission Planner
- **Performance Compliance**: No degradation of Mission Planner responsiveness

### Operational Benefits
- **Unified Interface**: Single application (Mission Planner) for complete SAR operations
- **Reduced Training**: Operators use familiar Mission Planner interface for RF operations
- **Streamlined Workflow**: RF control integrated into standard mission planning procedures
- **Enhanced Situational Awareness**: RF data visualization within primary flight interface
- **Simplified Deployment**: No additional software installation or configuration required

### Integration Verification
- **Mission Planner Compatibility**: Validated across Mission Planner 1.3.75+ versions
- **Workflow Efficiency**: Faster RF operations compared to separate applications
- **Safety Compliance**: All safety procedures accessible through Mission Planner interface
- **Documentation Completeness**: Comprehensive operator guides for integrated RF operations

---

**Story ID:** `6.3`  
**Epic:** `6 - ASV SDR Framework Integration`  
**Priority:** P0 - Critical for operator workflow efficiency and unified control interface  
**Dependencies:** Story 6.1 complete (Mission Planner foundation), Story 6.2 in progress (enhanced telemetry data)  
**Hardware Requirements:** Existing Cube Red + Mission Planner workstation (no additional hardware)  
**Estimated Total Effort:** 14-20 hours across 2-3 weeks  
**Build Status:** âœ… **READY TO PROCEED** after Story 6.1 completion