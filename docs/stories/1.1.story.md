# Story 1.1: Project Setup & Development Environment

## Status
Ready for Review

## Story
**As a** developer,  
**I want** a properly configured development environment with all dependencies,  
**so that** I can build, test, and deploy the RF-homing payload software consistently.

## Acceptance Criteria
1. Git repository initialized with .gitignore for Python projects and README.md with project overview
2. Python 3.10+ environment managed by uv with pyproject.toml including: asyncio, numpy, scipy, SoapySDR, FastAPI/Flask, pytest
3. Basic project structure created: /src, /tests, /config, /docs, /web/static, /web/templates
4. Systemd service file template created for auto-start on boot using uv
5. Configuration system implemented using YAML with default config file at /config/default.yaml
6. Basic logging setup with rotation configured to prevent SD card overflow
7. Development environment documented in /docs/setup.md with step-by-step uv/uvx instructions

## Tasks / Subtasks
- [x] Initialize Git repository and create .gitignore (AC: 1)
  - [x] Create .gitignore with Python standard patterns
  - [x] Initialize git repository
  - [x] Create initial README.md with project overview
- [x] Set up Python environment with uv (AC: 2)
  - [x] Install uv and create Python 3.13.5 environment [Source: architecture/tech-stack.md#Backend Language]
  - [x] Create pyproject.toml with core dependencies: FastAPI==0.116.1, numpy, scipy, SoapySDR, pytest==8.4.1, pytest-asyncio==1.1.0 [Source: architecture/tech-stack.md#Technology Stack Table]
  - [x] Create uv.lock file for reproducible builds
  - [x] Install and verify all dependencies with uv sync
- [x] Create project directory structure (AC: 3)
  - [x] Create main directories following unified project structure [Source: architecture/unified-project-structure.md]
  - [x] Create src/backend/ structure with core/, services/, api/, models/, utils/ subdirectories
  - [x] Create config/ directory with profiles/ subdirectory
  - [x] Create tests/backend/ structure with unit/ and integration/ subdirectories
  - [x] Create deployment/systemd/ directory
  - [x] Create scripts/ directory for utility scripts
  - [x] Note: Web templates will be in src/frontend/ not /web/ as per architecture
- [x] Create systemd service template (AC: 4)
  - [x] Create deployment/systemd/rf-homing.service template file
  - [x] Configure service for automatic startup on boot
  - [x] Include restart policy and logging configuration
- [x] Implement configuration system (AC: 5)
  - [x] Create config/default.yaml with base configuration structure
  - [x] Create Python configuration loader in src/backend/core/config.py [Source: architecture/unified-project-structure.md#Backend Structure]
  - [x] Include configuration for SDR settings, thresholds, and logging
- [x] Set up logging system (AC: 6)
  - [x] Create logging utility in src/backend/utils/logging.py [Source: architecture/unified-project-structure.md#Backend Utils]
  - [x] Configure Python logging with rotation using systemd journal integration [Source: architecture/tech-stack.md#Logging]
  - [x] Set appropriate log levels and format for structured logging
- [x] Create setup documentation (AC: 7)
  - [x] Create docs/setup.md with installation instructions
  - [x] Document uv installation and Python 3.13.5 management
  - [x] Include uvx usage for one-off commands
  - [x] Include SDR driver installation steps
  - [x] Document systemd service installation and configuration with uv
- [x] Write unit tests for configuration and logging systems
  - [x] Create tests/backend/unit/test_config.py
  - [x] Create tests/backend/unit/test_logging.py
  - [x] Ensure tests follow pytest patterns [Source: architecture/testing-strategy.md#Backend Tests]

## Dev Notes

### Previous Story Insights
No previous story exists - this is the first story in the project.

### Project Structure Alignment
The epic specifies /web/static and /web/templates directories, but the architecture defines a React frontend in src/frontend/. The project will follow the architecture's structure with a React frontend rather than traditional web templates. [Source: architecture/unified-project-structure.md]

### Technology Stack
- **Python Package Manager**: uv (latest) for fast dependency management [Source: architecture/tech-stack.md#Python Package Manager]
- **Python Runner**: uvx for isolated command execution [Source: architecture/tech-stack.md#Python Runner]
- **Python Version**: 3.11-3.13 managed by uv [Source: architecture/tech-stack.md#Backend Language]
- **Backend Framework**: FastAPI 0.116.1 for REST API and WebSocket server [Source: architecture/tech-stack.md#Backend Framework]
- **Testing Framework**: pytest 8.4.1 with pytest-asyncio 1.1.0 for async testing [Source: architecture/tech-stack.md#Backend Testing]
- **Linting**: Ruff 0.8.6 for fast Python linting (10-100x faster than flake8/black) [Source: architecture/tech-stack.md#Backend Linting]
- **Database**: SQLite 3.50.4 for local data persistence [Source: architecture/tech-stack.md#Database]
- **Logging**: Python logging integrated with systemd journal [Source: architecture/tech-stack.md#Logging]

### File Locations
Based on the unified project structure, new files should be created at:
- Configuration loader: `src/backend/core/config.py`
- Logging utility: `src/backend/utils/logging.py`
- Main entry point: `src/backend/main.py`
- Project configuration: `pyproject.toml` (root level)
- Dependency lock file: `uv.lock` (root level)
- Python version: `.python-version` (root level)
- Systemd service: `deployment/systemd/rf-homing.service`
- Default config: `config/default.yaml`
- Setup documentation: `docs/setup.md`
[Source: architecture/unified-project-structure.md]

### Configuration System Requirements
- Access environment variables only through config objects, never process.env directly [Source: architecture/coding-standards.md#Critical Fullstack Rules]
- Config keys should use UPPER_SNAKE case naming convention [Source: architecture/coding-standards.md#Naming Conventions]
- Configuration profiles stored as YAML files in /config/profiles/ directory

### Logging Requirements
- Use structured logging with correlation IDs for request tracking [Source: architecture/coding-standards.md#Critical Fullstack Rules]
- Integrate with Prometheus 3.5.0 LTS for metrics [Source: architecture/tech-stack.md#Monitoring]
- Log rotation to prevent SD card overflow as specified in acceptance criteria

### Testing
- Test files location: `tests/backend/unit/` for unit tests [Source: architecture/testing-strategy.md#Backend Tests]
- Use pytest with pytest-asyncio for async code testing
- Configuration test file: `tests/backend/unit/test_config.py`
- Logging test file: `tests/backend/unit/test_logging.py`
- Follow the testing pyramid approach with unit tests as the foundation [Source: architecture/testing-strategy.md#Testing Pyramid]

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-08-12 | 1.0 | Initial story creation | Bob (Scrum Master) |
| 2025-08-12 | 1.1 | Completed implementation | James (Dev Agent) |
| 2025-08-12 | 1.2 | Migrated to uv package manager | James (Dev Agent) |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
Claude Opus 4.1 (claude-opus-4-1-20250805)

### Debug Log References
None - no errors encountered during implementation

### Completion Notes List
- Successfully initialized Git repository with comprehensive .gitignore
- Migrated from venv/pip to uv for 10-100x faster package management
- uv automatically installed Python 3.13.5 (system had 3.11.2)
- Created pyproject.toml with modern Python project configuration
- Generated uv.lock with 71 resolved dependencies for reproducible builds
- Updated systemd service to use uv for environment management
- Adjusted package versions for compatibility with ARM architecture
- Implemented full configuration system with YAML and environment variable support
- Created structured logging with correlation IDs and performance monitoring
- Comprehensive unit tests (39 tests) all passing with uv run pytest
- Documentation updated with complete uv/uvx setup instructions and commands
- Added Ruff configuration for fast linting (replaces flake8/black)

### File List
- .gitignore
- README.md
- pyproject.toml (replaced requirements.txt)
- uv.lock (dependency lock file)
- .python-version (Python 3.13.5 for uv)
- config/default.yaml
- src/backend/__init__.py
- src/backend/core/__init__.py
- src/backend/core/config.py
- src/backend/utils/__init__.py
- src/backend/utils/logging.py
- deployment/systemd/rf-homing.service (updated for uv)
- docs/setup.md (updated with uv instructions)
- docs/architecture.md (updated tech stack)
- docs/architecture/tech-stack.md (added uv/uvx)
- tests/__init__.py
- tests/backend/__init__.py
- tests/backend/unit/__init__.py
- tests/backend/unit/test_config.py
- tests/backend/unit/test_logging.py

## QA Results

### Review Date: 2025-08-12
### Reviewed By: Quinn (Senior Developer QA)

### Code Quality Assessment
Excellent implementation of the project setup story. The developer successfully migrated from traditional venv/pip to the modern uv package manager, achieving 10-100x faster dependency management. The code demonstrates strong architectural understanding with proper separation of concerns, comprehensive configuration management, and structured logging with correlation IDs. Test coverage is outstanding at 96% with 39 passing tests.

### Refactoring Performed
- **File**: deployment/systemd/rf-homing.service
  - **Change**: Changed Type from "notify" to "simple" and removed WatchdogSec
  - **Why**: The application doesn't implement systemd notify protocol, causing service startup issues
  - **How**: Prevents systemd from waiting for a notification that will never come, allowing proper service startup

- **File**: deployment/systemd/rf-homing.service
  - **Change**: Added /home/pisad/projects/pisad/data to ReadWritePaths
  - **Why**: Database writes to data/pisad.db would fail with ProtectSystem=strict
  - **How**: Ensures the service can write to the SQLite database as configured

- **File**: src/backend/core/config.py, src/backend/utils/logging.py
  - **Change**: Applied Ruff linting fixes for code style compliance
  - **Why**: Ensure consistent code formatting and modern Python 3.11+ type hints
  - **How**: Automated fixes for whitespace, imports organization, and type annotations

- **File**: src/backend/api/__init__.py, src/backend/services/__init__.py, src/backend/models/__init__.py
  - **Change**: Created missing __init__.py files
  - **Why**: Ensure proper Python package structure for all directories
  - **How**: Added module docstrings to maintain package integrity

- **File**: src/backend/core/config.py, src/backend/utils/logging.py
  - **Change**: Fixed all mypy type checking errors for strict type safety
  - **Why**: Ensure complete type safety with mypy --strict mode
  - **How**: Added proper type annotations for all functions, fixed generic types, and resolved type mismatches

- **File**: .pre-commit-config.yaml
  - **Change**: Created comprehensive pre-commit hooks configuration
  - **Why**: Automate code quality checks before commits
  - **How**: Configured Ruff, mypy, and pytest to run automatically on commit

### Compliance Check
- Coding Standards: ✓ All configuration keys use UPPER_SNAKE case as specified
- Project Structure: ✓ Follows unified project structure from architecture docs
- Testing Strategy: ✓ Unit tests follow pytest patterns with proper async support
- All ACs Met: ✓ All 7 acceptance criteria fully implemented and verified

### Improvements Checklist
[x] Fixed systemd service configuration for proper startup
[x] Added missing data directory to ReadWritePaths
[x] Applied Ruff linting for code style compliance
[x] Created missing __init__.py files for package structure
[x] Verified uv package manager integration working correctly

### Security Review
- Configuration system properly isolates environment variables with PISAD_ prefix
- Systemd service uses appropriate security hardening (NoNewPrivileges, ProtectSystem, PrivateTmp)
- No secrets or API keys exposed in configuration files
- Logging system properly sanitizes output with structured formatting

### Performance Considerations
- uv package manager provides 10-100x faster dependency resolution than pip
- Configuration uses singleton pattern to avoid repeated file I/O
- Logging includes performance monitoring utilities with timer support
- Rotating file handler prevents disk space exhaustion (10MB limit, 5 backups)

### Final Status
✓ Approved - Ready for Done